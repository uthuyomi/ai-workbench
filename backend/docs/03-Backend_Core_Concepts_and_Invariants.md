Backend Core Concepts and Invariants

本文書の位置づけ

本書は ai-workbench Backend における中核概念（Core Concepts）および不変条件（Invariants）を定義する文書である。

本 Backend のすべての設計・実装・改修は、本書に記載された内容に従わなければならない。 本文書は、機能仕様や実装詳細よりも 優先順位が高い。


---

Core Concepts（中核概念）

以下は、本 Backend を成立させるための中核概念である。 これらは単なる実装方針ではなく、システムの前提条件として扱う。


---

判断主体（Decision Authority）

本 Backend において、最終的な判断主体は常に人間である。

AI は、情報整理・提案・候補生成を行うが、 変更の可否や適用タイミングを決定してはならない。

AI が判断を行っているように見える挙動は、 設計違反として扱う。


---

判断補助としての AI

AI は「自動実行装置」ではなく、判断補助装置として扱う。

そのため、Backend は以下の性質を持つ。

変更案は常に Diff として生成される

変更理由を説明可能な形で提示する

人間の承認を前提とし、単独で完結しない



---

設計文書ファースト

本 Backend では、設計文書を一次成果物として扱う。

実装は設計文書の具現化である

設計文書に存在しない概念を実装してはならない

実装変更が必要な場合は、先に設計文書を更新する


設計文書と実装が乖離した場合、 実装側を誤りとみなす。


---

Workspace Index

Workspace Index は、Backend が扱うコードベースの「地図」である。

全ファイル内容を常時保持しない

構造・関係性・識別情報を保持する

必要な範囲のみをオンデマンドで参照する


Workspace Index は記憶装置ではなく、 参照を効率化するための構造データである。


---

Snapshot（オンデマンド参照）

Snapshot は、判断に必要な最小範囲の実データ参照を指す。

常時生成しない

必要なタイミングで生成する

判断完了後は破棄可能である


これにより、Backend はスケーラビリティと安全性を両立する。


---

Diff ファースト

Backend は、変更を「結果」ではなく「差分」として扱う。

生成物は常に Diff

Diff は全文置換（Full Replace）を基本とする

行単位の部分適用は行わない


これにより、変更内容の可視性と再現性を確保する。


---

Expression Layer の分離

キャラクター表現・口調・構文変換は、 Expression Layer に限定して行う。

判断ロジックに介入しない

判断結果を書き換えない

表現のみを変換する


Expression Layer は Backend の外観であり、 思考中枢ではない。


---

Invariants（不変条件）

以下の条件は、いかなる理由があっても破ってはならない。


---

Backend は実ファイルを直接編集しない

Backend は VSCode API を直接操作しない

Backend は自律的にタスクを進行しない

Backend は人間の承認なしに変更を適用しない

Backend は判断ロジックにキャラクター要素を混入させない

Backend は設計文書を無視した実装を許可しない



---

違反時の扱い

本文書に違反する実装・挙動が確認された場合、 それはバグではなく 設計違反 として扱う。

設計違反が発生した場合は、以下の順序で対処する。

1. 実装を停止する


2. 本文書との矛盾点を特定する


3. 必要であれば本文書を更新する


4. その後に実装を修正する




---

本文書の変更について

本文書の変更は、Backend 全体の思想変更を意味する

軽微な機能追加では変更しない

変更理由を必ず明記する



---

変更履歴

初版作成：ai-workbench Backend 設計フェーズ